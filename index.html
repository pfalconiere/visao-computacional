<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Classifier</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #fbfbfd;
            color: #1d1d1f;
            line-height: 1.47059;
            font-weight: 400;
            letter-spacing: -0.022em;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 980px;
            margin: 0 auto;
            padding: 0 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 21px;
            font-weight: 600;
            letter-spacing: -0.021em;
            color: #1d1d1f;
        }

        /* Language Toggle */
        .lang-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.04);
            border-radius: 980px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .lang-toggle:hover {
            background: rgba(0, 0, 0, 0.08);
        }

        .lang-toggle span {
            font-size: 13px;
            color: #6e6e73;
            font-weight: 500;
        }

        .lang-toggle .active {
            color: #0071e3;
        }

        /* Main Content */
        main {
            flex: 1;
            max-width: 980px;
            margin: 0 auto;
            padding: 80px 22px 100px;
            width: 100%;
        }

        .hero {
            text-align: center;
            margin-bottom: 60px;
        }

        .hero h1 {
            font-size: 56px;
            line-height: 1.07143;
            font-weight: 600;
            letter-spacing: -0.005em;
            margin-bottom: 6px;
        }

        .hero p {
            font-size: 21px;
            line-height: 1.381;
            font-weight: 400;
            letter-spacing: 0.011em;
            color: #6e6e73;
        }

        /* Upload Section */
        .upload-section {
            background: white;
            border-radius: 18px;
            padding: 48px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            margin-bottom: 40px;
        }

        .upload-area {
            border: 2px dashed #d2d2d7;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fbfbfd;
        }

        .upload-area:hover {
            border-color: #0071e3;
            background: #f5f5f7;
        }

        .upload-area.dragover {
            border-color: #0071e3;
            background: #e8f4fd;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 17px;
            color: #6e6e73;
            margin-bottom: 12px;
        }

        .upload-button {
            display: inline-block;
            background: #0071e3;
            color: white;
            padding: 12px 24px;
            border-radius: 980px;
            font-size: 17px;
            font-weight: 400;
            cursor: pointer;
            border: none;
            transition: background 0.2s ease;
        }

        .upload-button:hover {
            background: #0077ed;
        }

        .file-input {
            display: none;
        }

        /* Preview Section */
        .preview-section {
            display: none;
            background: white;
            border-radius: 18px;
            padding: 48px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            margin-bottom: 40px;
        }

        .preview-section.show {
            display: block;
        }

        .preview-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 24px;
            text-align: center;
        }

        .preview-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 500px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .classify-button {
            background: #0071e3;
            color: white;
            padding: 14px 32px;
            border-radius: 980px;
            font-size: 17px;
            font-weight: 400;
            border: none;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .classify-button:hover {
            background: #0077ed;
        }

        .classify-button:disabled {
            background: #d2d2d7;
            cursor: not-allowed;
        }

        /* Result Section */
        .result-section {
            display: none;
            background: white;
            border-radius: 18px;
            padding: 48px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .result-section.show {
            display: block;
        }

        .result-type {
            text-align: center;
            margin-bottom: 40px;
        }

        .result-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .result-label {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .feature-card {
            background: #f5f5f7;
            padding: 20px;
            border-radius: 12px;
        }

        .feature-name {
            font-size: 13px;
            color: #6e6e73;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .feature-value {
            font-size: 24px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .new-classification {
            text-align: center;
        }

        .new-button {
            background: transparent;
            color: #0071e3;
            padding: 12px 24px;
            border-radius: 980px;
            font-size: 17px;
            border: 2px solid #0071e3;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .new-button:hover {
            background: #0071e3;
            color: white;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0071e3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error */
        .error {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            color: #856404;
        }

        .error.show {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 40px;
            }

            .hero p {
                font-size: 17px;
            }

            .upload-section,
            .preview-section,
            .result-section {
                padding: 24px;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">Document Classifier</div>
            <div class="lang-toggle" onclick="toggleLanguage()">
                <span id="lang-pt" class="active">PT</span>
                <span>|</span>
                <span id="lang-en">EN</span>
            </div>
        </div>
    </header>

    <main>
        <div class="hero">
            <h1 id="hero-title">Classifique documentos</h1>
            <p id="hero-subtitle">Diferencie advertisements de scientific articles com IA</p>
        </div>

        <div class="error" id="error"></div>

        <div class="upload-section" id="upload-section">
            <div class="upload-area" id="upload-area" onclick="document.getElementById('file-input').click()">
                <div class="upload-icon">ðŸ“„</div>
                <div class="upload-text" id="upload-text">Arraste uma imagem .tif ou clique para selecionar</div>
                <button class="upload-button" id="upload-button">Escolher arquivo</button>
            </div>
            <input type="file" id="file-input" class="file-input" accept=".tif,.tiff" onchange="handleFileSelect(event)">
        </div>

        <div class="preview-section" id="preview-section">
            <h2 class="preview-title" id="preview-title">Preview da imagem</h2>
            <div class="preview-container">
                <img id="preview-image" class="preview-image" alt="Preview">
                <button class="classify-button" id="classify-button" onclick="classifyImage()">Classificar documento</button>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p id="loading-text">Analisando documento...</p>
        </div>

        <div class="result-section" id="result-section">
            <div class="result-type">
                <div class="result-icon" id="result-icon">ðŸ“°</div>
                <h2 class="result-label" id="result-label">Advertisement</h2>
            </div>

            <div class="features-grid" id="features-grid">
                <!-- Features will be inserted here -->
            </div>

            <div class="new-classification">
                <button class="new-button" onclick="resetClassifier()" id="new-button">Nova classificaÃ§Ã£o</button>
            </div>
        </div>
    </main>

    <script>
        let currentLang = 'pt';
        let currentFile = null;
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:5000'
            : 'https://visao-computacional.onrender.com';

        const translations = {
            pt: {
                heroTitle: 'Classifique documentos',
                heroSubtitle: 'Diferencie advertisements de scientific articles com IA',
                uploadText: 'Arraste uma imagem .tif ou clique para selecionar',
                uploadButton: 'Escolher arquivo',
                previewTitle: 'Preview da imagem',
                classifyButton: 'Classificar documento',
                loadingText: 'Analisando documento...',
                newButton: 'Nova classificaÃ§Ã£o',
                advertisement: 'Advertisement',
                scientificArticle: 'Artigo CientÃ­fico',
                features: {
                    altura_media: 'Altura MÃ©dia',
                    largura_media: 'Largura MÃ©dia',
                    desvio_altura: 'Desvio Altura',
                    aspect_ratio: 'Aspect Ratio',
                    colunas_detectadas: 'Colunas',
                    densidade_texto: 'Densidade',
                    num_componentes: 'Componentes',
                    transicoes_layout: 'TransiÃ§Ãµes'
                },
                errorTiff: 'Por favor, selecione um arquivo .tif ou .tiff',
                errorClassify: 'Erro ao classificar. Tente novamente.'
            },
            en: {
                heroTitle: 'Classify documents',
                heroSubtitle: 'Differentiate advertisements from scientific articles with AI',
                uploadText: 'Drag a .tif image or click to select',
                uploadButton: 'Choose file',
                previewTitle: 'Image preview',
                classifyButton: 'Classify document',
                loadingText: 'Analyzing document...',
                newButton: 'New classification',
                advertisement: 'Advertisement',
                scientificArticle: 'Scientific Article',
                features: {
                    altura_media: 'Average Height',
                    largura_media: 'Average Width',
                    desvio_altura: 'Height Deviation',
                    aspect_ratio: 'Aspect Ratio',
                    colunas_detectadas: 'Columns',
                    densidade_texto: 'Density',
                    num_componentes: 'Components',
                    transicoes_layout: 'Transitions'
                },
                errorTiff: 'Please select a .tif or .tiff file',
                errorClassify: 'Classification error. Please try again.'
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'pt' ? 'en' : 'pt';
            document.getElementById('lang-pt').classList.toggle('active');
            document.getElementById('lang-en').classList.toggle('active');
            updateTexts();
        }

        function updateTexts() {
            const t = translations[currentLang];
            document.getElementById('hero-title').textContent = t.heroTitle;
            document.getElementById('hero-subtitle').textContent = t.heroSubtitle;
            document.getElementById('upload-text').textContent = t.uploadText;
            document.getElementById('upload-button').textContent = t.uploadButton;
            document.getElementById('preview-title').textContent = t.previewTitle;
            document.getElementById('classify-button').textContent = t.classifyButton;
            document.getElementById('loading-text').textContent = t.loadingText;
            document.getElementById('new-button').textContent = t.newButton;
        }

        // Drag and drop
        const uploadArea = document.getElementById('upload-area');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.add('dragover');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.remove('dragover');
            }, false);
        });

        uploadArea.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFile(file) {
            if (!file.name.toLowerCase().endsWith('.tif') && !file.name.toLowerCase().endsWith('.tiff')) {
                showError(translations[currentLang].errorTiff);
                return;
            }

            currentFile = file;
            hideError();

            // Show preview
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('preview-image').src = e.target.result;
                document.getElementById('upload-section').style.display = 'none';
                document.getElementById('preview-section').classList.add('show');
            };
            reader.readAsDataURL(file);
        }

        async function classifyImage() {
            if (!currentFile) return;

            hideError();
            document.getElementById('preview-section').classList.remove('show');
            document.getElementById('loading').classList.add('show');

            const formData = new FormData();
            formData.append('image', currentFile);

            try {
                const response = await fetch(`${API_URL}/classify`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    displayResult(data);
                } else {
                    throw new Error(data.error || 'Classification failed');
                }
            } catch (error) {
                console.error('Error:', error);
                showError(translations[currentLang].errorClassify);
                document.getElementById('preview-section').classList.add('show');
            } finally {
                document.getElementById('loading').classList.remove('show');
            }
        }

        function displayResult(data) {
            const t = translations[currentLang];
            const isAd = data.classification === 'advertisement';

            // Icon and label
            document.getElementById('result-icon').textContent = isAd ? 'ðŸ“°' : 'ðŸ“š';
            document.getElementById('result-label').textContent = isAd ? t.advertisement : t.scientificArticle;

            // Features
            const featuresGrid = document.getElementById('features-grid');
            featuresGrid.innerHTML = '';

            const features = data.features || {};
            const featureMap = {
                'altura_media': features.altura_media,
                'largura_media': features.largura_media,
                'desvio_altura': features.desvio_altura,
                'aspect_ratio': features.aspect_ratio,
                'densidade_texto': features.densidade_texto,
                'num_componentes': features.num_componentes,
                'transicoes_layout': features.transicoes_layout,
                'colunas_detectadas': features.colunas_detectadas
            };

            Object.entries(featureMap).forEach(([key, value]) => {
                if (value !== undefined) {
                    const card = document.createElement('div');
                    card.className = 'feature-card';
                    
                    const name = document.createElement('div');
                    name.className = 'feature-name';
                    name.textContent = t.features[key] || key;
                    
                    const val = document.createElement('div');
                    val.className = 'feature-value';
                    val.textContent = typeof value === 'number' ? value.toFixed(2) : value;
                    
                    card.appendChild(name);
                    card.appendChild(val);
                    featuresGrid.appendChild(card);
                }
            });

            document.getElementById('result-section').classList.add('show');
        }

        function resetClassifier() {
            currentFile = null;
            document.getElementById('file-input').value = '';
            document.getElementById('result-section').classList.remove('show');
            document.getElementById('preview-section').classList.remove('show');
            document.getElementById('upload-section').style.display = 'block';
            hideError();
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            document.getElementById('error').classList.remove('show');
        }
    </script>
</body>
</html>
