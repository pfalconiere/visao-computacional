<!DOCTYPE html>
<!-- Updated: 2025-10-25 19:50:00 - Cache Buster v2 -->
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Document Classifier - With Feedback</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.jsdelivr.net/npm/tiff.js@latest/tiff.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: #fbfbfd;
            color: #1d1d1f;
            line-height: 1.47059;
            font-weight: 400;
            letter-spacing: -0.022em;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 21px;
            font-weight: 600;
            letter-spacing: -0.021em;
            color: #1d1d1f;
        }

        .lang-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.04);
            border-radius: 980px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .lang-toggle:hover {
            background: rgba(0, 0, 0, 0.08);
        }

        .lang-toggle span {
            font-size: 13px;
            color: #6e6e73;
            font-weight: 500;
        }

        .lang-toggle .active {
            color: #0071e3;
        }

        main {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 80px 22px 100px;
            width: 100%;
        }

        .hero {
            text-align: center;
            margin-bottom: 60px;
        }

        .hero h1 {
            font-size: 56px;
            line-height: 1.07143;
            font-weight: 600;
            letter-spacing: -0.005em;
            margin-bottom: 6px;
        }

        .hero p {
            font-size: 21px;
            line-height: 1.381;
            font-weight: 400;
            letter-spacing: 0.011em;
            color: #6e6e73;
        }

        .upload-section {
            background: white;
            border-radius: 18px;
            padding: 48px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            margin-bottom: 40px;
        }

        .upload-area {
            border: 2px dashed #d2d2d7;
            border-radius: 12px;
            padding: 60px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fbfbfd;
        }

        .upload-area:hover {
            border-color: #1d1d1f;
            background: #f5f5f7;
        }

        .upload-area.dragover {
            border-color: #1d1d1f;
            background: #f0f0f0;
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 17px;
            color: #6e6e73;
            margin-bottom: 12px;
        }

        .upload-button {
            display: inline-block;
            background: #1d1d1f;
            color: white;
            padding: 12px 24px;
            border-radius: 980px;
            font-size: 17px;
            font-weight: 400;
            cursor: pointer;
            border: none;
            transition: background 0.2s ease;
        }

        .upload-button:hover {
            background: #424245;
        }

        .file-input {
            display: none;
        }

        .preview-section {
            display: none;
            background: white;
            border-radius: 18px;
            padding: 48px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            margin-bottom: 40px;
        }

        .preview-section.show {
            display: block;
        }

        .preview-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 24px;
            text-align: center;
        }

        .preview-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 24px;
        }

        .preview-image-container {
            width: 100%;
            max-width: 600px;
            background: #f5f5f7;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .preview-image {
            width: 100%;
            height: auto;
            display: block;
        }

        .file-info {
            text-align: center;
            margin-top: 12px;
        }

        .file-name {
            font-size: 15px;
            color: #6e6e73;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 13px;
            color: #86868b;
        }

        .classify-button {
            background: #1d1d1f;
            color: white;
            padding: 14px 32px;
            border-radius: 980px;
            font-size: 17px;
            font-weight: 400;
            border: none;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .classify-button:hover {
            background: #424245;
        }

        .classify-button:disabled {
            background: #d2d2d7;
            cursor: not-allowed;
        }

        .result-section {
            display: none;
            background: white;
            border-radius: 18px;
            padding: 48px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }

        .result-section.show {
            display: block;
        }

        .result-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 32px;
            align-items: start;
        }

        .result-preview {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .result-preview-title {
            font-size: 17px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .result-preview-image {
            width: 100%;
            background: #f5f5f7;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .result-preview-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .result-preview-info {
            text-align: center;
            padding: 8px 0;
        }

        .result-preview-info .file-name {
            font-size: 13px;
            color: #6e6e73;
            margin-bottom: 2px;
        }

        .result-preview-info .file-size {
            font-size: 12px;
            color: #86868b;
        }

        .result-classification {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .result-type {
            text-align: center;
            margin-bottom: 24px;
            padding: 0 0 24px 0;
            background: transparent;
            border-bottom: 1px solid #e5e5e7;
        }

        .result-icon {
            font-size: 64px;
            margin-bottom: 12px;
        }

        .result-label {
            font-size: 28px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .feature-card {
            background: #f5f5f7;
            padding: 16px;
            border-radius: 12px;
        }

        .feature-name {
            font-size: 11px;
            color: #6e6e73;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .feature-value {
            font-size: 20px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .explanation-text {
            background: transparent;
            padding: 0;
            font-size: 15px;
            line-height: 1.6;
            color: #1d1d1f;
            margin-bottom: 16px;
            text-align: left;
        }

        .paragraph-count {
            background: transparent;
            padding: 0;
            margin-top: 12px;
            font-size: 15px;
            color: #1d1d1f;
            text-align: left;
        }

        .paragraph-count strong {
            font-weight: 600;
        }

        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 4px;
            margin-top: 16px;
            margin-bottom: 16px;
        }

        .stat-item {
            background: transparent;
            padding: 0;
            font-size: 15px;
            color: #1d1d1f;
            text-align: left;
        }

        .stat-item strong {
            font-weight: 600;
        }

        /* Feedback Section */
        .feedback-section {
            background: transparent;
            padding: 24px 0;
            margin-top: 32px;
            border-top: 1px solid #e5e5e7;
        }

        .feedback-title {
            font-size: 17px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 16px;
            color: #1d1d1f;
        }

        .feedback-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .feedback-btn {
            flex: 1;
            padding: 12px 24px;
            border-radius: 980px;
            font-size: 15px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .feedback-btn-correct {
            background: #1d1d1f;
            color: white;
        }

        .feedback-btn-correct:hover {
            background: #424245;
        }

        .feedback-btn-incorrect {
            background: #1d1d1f;
            color: white;
        }

        .feedback-btn-incorrect:hover {
            background: #424245;
        }

        .feedback-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .feedback-success {
            text-align: center;
            color: #34c759;
            font-size: 15px;
            font-weight: 500;
            padding: 12px;
        }

        .new-classification {
            text-align: center;
        }

        .new-button {
            background: #1d1d1f;
            color: white;
            padding: 12px 24px;
            border-radius: 980px;
            font-size: 17px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .new-button:hover {
            background: #424245;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0071e3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            display: none;
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            color: #856404;
        }

        .error.show {
            display: block;
        }

        .converting {
            text-align: center;
            padding: 20px;
            color: #6e6e73;
            font-size: 15px;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 40px;
            }

            .hero p {
                font-size: 17px;
            }

            .upload-section,
            .preview-section,
            .result-section {
                padding: 24px;
            }

            .result-layout {
                grid-template-columns: 1fr;
                gap: 24px;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .feedback-buttons {
                flex-direction: column;
            }
        }
    
        .config-section {
            background: white;
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            margin-bottom: 40px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .config-title {
            font-size: 19px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #1d1d1f;
        }

        .config-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .config-field {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .config-field label {
            font-size: 14px;
            font-weight: 500;
            color: #6e6e73;
        }

        .config-field input {
            padding: 10px 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.2s ease;
        }

        .config-field input:focus {
            outline: none;
            border-color: #0071e3;
        }

        .word-list {
            list-style: disc;
            padding-left: 20px;
            margin: 12px auto;
            text-align: left;
            column-count: 1;
            column-gap: 20px;
            display: inline-block;
            max-width: 400px;
        }

        .word-list li {
            margin-bottom: 6px;
            font-size: 14px;
            color: #1d1d1f;
        }

        .words-container {
            text-align: center;
            margin-top: 16px;
        }
        
        .words-title {
            text-align: left;
        }

        @media (min-width: 768px) {
            .word-list.multi-column {
                column-count: 2;
            }
        }

    
        .rule-button {
            padding: 6px 16px;
            background: #1d1d1f;
            color: white;
            border: none;
            border-radius: 980px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .rule-button:hover {
            background: #424245;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 18px;
            padding: 32px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 24px;
            color: #1d1d1f;
        }

        .modal-field {
            margin-bottom: 20px;
        }

        .modal-field label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #6e6e73;
            margin-bottom: 8px;
        }

        .modal-field input {
            width: 100%;
            padding: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }

        .modal-field input:focus {
            outline: none;
            border-color: #0071e3;
        }

        .modal-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border-radius: 980px;
            font-size: 15px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .modal-btn-cancel {
            background: #f5f5f7;
            color: #1d1d1f;
        }

        .modal-btn-cancel:hover {
            background: #e8e8ed;
        }

        .modal-btn-confirm {
            background: #1d1d1f;
            color: white;
        }

        .modal-btn-confirm:hover {
            background: #424245;
        }

    
        .api-link {
            padding: 6px 16px;
            background: #1d1d1f;
            color: white;
            text-decoration: none;
            border-radius: 980px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-block;
        }

        .api-link:hover {
            background: #424245;
            text-decoration: none;
        }

    
        footer {
            background: #f5f5f7;
            border-top: 1px solid rgba(0, 0, 0, 0.08);
            padding: 32px 22px;
            margin-top: 80px;
            text-align: center;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-text {
            font-size: 12px;
            line-height: 1.6;
            color: #6e6e73;
        }

        .footer-text strong {
            color: #1d1d1f;
            font-weight: 600;
        }

        .footer-year {
            font-size: 12px;
            color: #86868b;
            margin-top: 8px;
        }

    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo" data-testid="app-logo">Document Classifier</div>
            <div style="display: flex; gap: 16px; align-items: center;">
                <a href="${API_URL}/api/docs" target="_blank" class="api-link" data-testid="api-link" id="api-link">API</a>
                <button class="rule-button" data-testid="rule-button" id="rule-button" onclick="openRuleModal()">
                    <span id="rule-btn-text">Alterar Regra</span>
                </button>
                <div class="lang-toggle" data-testid="lang-toggle" onclick="toggleLanguage()">
                    <span id="lang-pt" class="active" data-testid="lang-pt">PT</span>
                    <span>|</span>
                    <span id="lang-en" data-testid="lang-en">EN</span>
                </div>
            </div>
        </div>
    </header>

    <main>
        <div class="hero">
            <h1 id="hero-title" data-testid="hero-title">Classifique documentos</h1>
            <p id="hero-subtitle" data-testid="hero-subtitle">Diferencie advertisements de scientific articles com IA</p>
        </div>
        </div>

        <div class="error" id="error" data-testid="error-message"></div>

        <div class="upload-section" id="upload-section">
            <div class="upload-area" id="upload-area" data-testid="upload-area" onclick="document.getElementById('file-input').click()">
                <div class="upload-icon" data-testid="upload-icon">üìÑ</div>
                <div class="upload-text" id="upload-text" data-testid="upload-text">Arraste uma imagem .tif ou clique para selecionar</div>
                <button class="upload-button" id="upload-button" data-testid="upload-button">Escolher arquivo</button>
            </div>
            <input type="file" id="file-input" class="file-input" data-testid="file-input" accept=".tif,.tiff">
        </div>

        <div class="preview-section" id="preview-section" data-testid="preview-section">
            <h2 class="preview-title" id="preview-title">Preview</h2>
            <div class="preview-container">
                <div class="converting" id="converting" style="display: none;">Processando imagem...</div>
                <div class="preview-image-container" id="preview-image-container">
                    <img id="preview-image" data-testid="preview-image" class="preview-image" alt="Preview">
                </div>
                <div class="file-info">
                    <div class="file-name" id="file-name">document.tif</div>
                    <div class="file-size" id="file-size">0 KB</div>
                </div>
                <button class="classify-button" id="classify-button" data-testid="classify-button" onclick="classifyImage()">Classificar documento</button>
            </div>
        </div>

        <div class="loading" id="loading" data-testid="loading">
            <div class="spinner"></div>
            <p id="loading-text">Analisando documento...</p>
        </div>

        <div class="result-section" id="result-section" data-testid="result-section">
            <div class="result-layout">
                <div class="result-preview">
                    <h3 class="result-preview-title" id="result-preview-title">Documento analisado</h3>
                    <div class="result-preview-image">
                        <img id="result-preview-img" alt="Document">
                    </div>
                    <div class="result-preview-info">
                        <div class="file-name" id="result-file-name">document.tif</div>
                        <div class="file-size" id="result-file-size">0 KB</div>
                    </div>
                </div>

                <div class="result-classification">
                    <div class="result-type">
                        <div class="result-icon" id="result-icon"></div>
                        <h2 class="result-label" id="result-label">Advertisement</h2>
                    </div>

                    <div class="features-grid" id="features-grid"></div>

                    <!-- FEEDBACK SECTION -->
                    <div class="feedback-section" id="feedback-section">
                        <div class="feedback-title" id="feedback-title">Esta classifica√ß√£o est√° correta?</div>
                        <div class="feedback-buttons" id="feedback-buttons">
                            <button class="feedback-btn feedback-btn-correct" onclick="sendFeedback(true)">
                                Correto
                            </button>
                            <button class="feedback-btn feedback-btn-incorrect" onclick="sendFeedback(false)">
                                Incorreto
                            </button>
                        </div>
                        <div class="feedback-success" id="feedback-success" style="display: none;"></div>
                    </div>
                </div>
            </div>

            <div class="new-classification">
                <button class="new-button" onclick="resetClassifier()" id="new-button">Nova classifica√ß√£o</button>
            </div>
        </div>
    </main>

    <script>
        let currentLang = 'pt';
        let currentFile = null;
        let currentPreviewUrl = null;
        let currentClassification = null;
        let currentFullResult = null;
        let feedbackSent = false;
        let ruleConfigured = false;
        let minWords = 2000;
        let minParagraphs = 8;
        
        const API_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:5000'
            : 'https://visao-computacional.onrender.com';

        const translations = {
            pt: {
                heroTitle: 'Classifique documentos',
                heroSubtitle: 'Diferencie advertisements de scientific articles com IA',
                uploadText: 'Arraste uma imagem .tif ou clique para selecionar',
                uploadButton: 'Escolher arquivo',
                previewTitle: 'Preview',
                classifyButton: 'Classificar documento',
                loadingText: 'Analisando documento...',
                convertingText: 'Processando imagem...',
                newButton: 'Nova classifica√ß√£o',
                resultPreviewTitle: 'Documento analisado',
                feedbackTitle: 'Esta classifica√ß√£o est√° correta?',
                feedbackCorrect: 'Correto',
                feedbackIncorrect: 'Incorreto',
                feedbackSuccess: '‚úì Obrigado pelo feedback!',
                advertisement: 'Advertisement',
                scientificArticle: 'Artigo Cient√≠fico',
                paragraphs: 'Par√°grafos',
                features: {
                    avg_component_height: 'Altura M√©dia',
                    avg_component_width: 'Largura M√©dia',
                    height_std: 'Desvio Altura',
                    avg_aspect_ratio: 'Aspect Ratio',
                    num_columns_detected: 'Colunas',
                    text_density: 'Densidade',
                    num_text_components: 'Componentes',
                    num_paragraphs: 'Par√°grafos',
                    layout_transitions: 'Transi√ß√µes'
                },
                                footerText: 'Trabalho do Curso de <strong>Mestrado de Engenharia de Software 2025.1</strong><br>C.E.S.A.R - Todos os direitos reservados',
                errorTiff: 'Por favor, selecione um arquivo .tif ou .tiff',
                                
                changeRule: 'Alterar Regra',
                modalTitle: 'Configurar Regras de Conformidade',
                modalLabelWords: 'M√≠nimo de Palavras',
                modalLabelParagraphs: 'M√≠nimo de Par√°grafos',
                modalCancel: 'Cancelar',
                modalConfirm: 'Confirmar',
                                configTitle: 'Configurar Regras de Conformidade',
                labelMinWords: 'M√≠nimo de Palavras',
                labelMinParagraphs: 'M√≠nimo de Par√°grafos',
                frequentWordsTitle: 'Palavras mais frequentes:',
                errorClassify: 'Erro ao classificar. Tente novamente.'
            },
            en: {
                heroTitle: 'Classify documents',
                heroSubtitle: 'Differentiate advertisements from scientific articles with AI',
                uploadText: 'Drag a .tif image or click to select',
                uploadButton: 'Choose file',
                previewTitle: 'Preview',
                classifyButton: 'Classify document',
                loadingText: 'Analyzing document...',
                convertingText: 'Processing image...',
                newButton: 'New classification',
                resultPreviewTitle: 'Analyzed document',
                feedbackTitle: 'Is this classification correct?',
                feedbackCorrect: 'Correct',
                feedbackIncorrect: 'Incorrect',
                feedbackSuccess: '‚úì Thanks for your feedback!',
                advertisement: 'Advertisement',
                scientificArticle: 'Scientific Article',
                paragraphs: 'Paragraphs',
                features: {
                    avg_component_height: 'Average Height',
                    avg_component_width: 'Average Width',
                    height_std: 'Height Deviation',
                    avg_aspect_ratio: 'Aspect Ratio',
                    num_columns_detected: 'Columns',
                    text_density: 'Density',
                    num_text_components: 'Components',
                    num_paragraphs: 'Paragraphs',
                    layout_transitions: 'Transitions'
                },
                                footerText: 'Work from the <strong>Software Engineering Master\'s Degree Course 2025.1</strong><br>C.E.S.A.R - All rights reserved',
                errorTiff: 'Please select a .tif or .tiff file',
                                
                changeRule: 'Change Rule',
                modalTitle: 'Configure Compliance Rules',
                modalLabelWords: 'Minimum Words',
                modalLabelParagraphs: 'Minimum Paragraphs',
                modalCancel: 'Cancel',
                modalConfirm: 'Confirm',
                                configTitle: 'Configure Compliance Rules',
                labelMinWords: 'Minimum Words',
                labelMinParagraphs: 'Minimum Paragraphs',
                frequentWordsTitle: 'Most frequent words:',
                errorClassify: 'Classification error. Please try again.'
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'pt' ? 'en' : 'pt';
            document.getElementById('lang-pt').classList.toggle('active');
            document.getElementById('lang-en').classList.toggle('active');
            updateTexts();
        }

        function updateTexts() {
            const t = translations[currentLang];
            document.getElementById('hero-title').textContent = t.heroTitle;
            document.getElementById('hero-subtitle').textContent = t.heroSubtitle;
            document.getElementById('upload-text').textContent = t.uploadText;
            document.getElementById('upload-button').textContent = t.uploadButton;
            document.getElementById('preview-title').textContent = t.previewTitle;
            document.getElementById('classify-button').textContent = t.classifyButton;
            document.getElementById('loading-text').textContent = t.loadingText;
            document.getElementById('converting').textContent = t.convertingText;
            document.getElementById('new-button').textContent = t.newButton;
            document.getElementById('result-preview-title').textContent = t.resultPreviewTitle;
            document.getElementById('feedback-title').textContent = t.feedbackTitle;
            document.getElementById('rule-btn-text').textContent = t.changeRule;
            updateModalTexts();
                        
            const buttons = document.querySelectorAll('.feedback-btn');
            if (buttons[0]) buttons[0].innerHTML = t.feedbackCorrect;
            if (buttons[1]) buttons[1].innerHTML = t.feedbackIncorrect;
            
            document.getElementById('footer-text').innerHTML = t.footerText;
            
            updateExplanationLanguage();
        }

        const uploadArea = document.getElementById('upload-area');
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.add('dragover');
            }, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => {
                uploadArea.classList.remove('dragover');
            }, false);
        });

        uploadArea.addEventListener('drop', handleDrop, false);

        // Add event listener for file input
        document.getElementById('file-input').addEventListener('change', handleFileSelect, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        }

        async function handleFile(file) {
            if (!file.name.toLowerCase().endsWith('.tif') && !file.name.toLowerCase().endsWith('.tiff')) {
                showError(translations[currentLang].errorTiff);
                return;
            }

            currentFile = file;
            hideError();

            const fileSize = (file.size / 1024).toFixed(2);
            document.getElementById('file-name').textContent = file.name;
            document.getElementById('file-size').textContent = fileSize + ' KB';
            
            document.getElementById('upload-section').style.display = 'none';
            document.getElementById('preview-section').classList.add('show');
            document.getElementById('converting').style.display = 'block';
            document.getElementById('preview-image-container').style.display = 'none';

            try {
                const arrayBuffer = await file.arrayBuffer();
                const tiff = new Tiff({buffer: arrayBuffer});
                const canvas = tiff.toCanvas();
                
                if (canvas) {
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.9);
                    currentPreviewUrl = dataUrl;
                    document.getElementById('preview-image').src = dataUrl;
                    document.getElementById('preview-image-container').style.display = 'block';
                }
            } catch (error) {
                console.log('Could not convert TIFF:', error);
                const placeholderUrl = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="600" height="400" viewBox="0 0 600 400"%3E%3Crect width="600" height="400" fill="%23f5f5f7"/%3E%3Ctext x="50%25" y="50%25" font-family="system-ui" font-size="48" fill="%236e6e73" text-anchor="middle" dominant-baseline="middle"%3EüñºÔ∏è%3C/text%3E%3Ctext x="50%25" y="65%25" font-family="system-ui" font-size="16" fill="%2386868b" text-anchor="middle" dominant-baseline="middle"%3ETIFF Document%3C/text%3E%3C/svg%3E';
                currentPreviewUrl = placeholderUrl;
                document.getElementById('preview-image').src = placeholderUrl;
                document.getElementById('preview-image-container').style.display = 'block';
            } finally {
                document.getElementById('converting').style.display = 'none';
            }
        }

        async function classifyImage() {
            if (!currentFile) return;

            hideError();
            document.getElementById('preview-section').classList.remove('show');
            document.getElementById('loading').classList.add('show');

            const formData = new FormData();
            formData.append('image', currentFile);
            formData.append('min_words', minWords);
            formData.append('min_paragraphs', minParagraphs);
            formData.append('language', currentLang);

            try {
                const response = await fetch(`${API_URL}/classify`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    currentClassification = data;
                    feedbackSent = false;
                    displayResult(data);
                } else {
                    throw new Error(data.error || 'Classification failed');
                }
            } catch (error) {
                console.error('Error:', error);
                showError(translations[currentLang].errorClassify);
                document.getElementById('preview-section').classList.add('show');
            } finally {
                document.getElementById('loading').classList.remove('show');
            }
        }

        function displayResult(data) {
            currentFullResult = data;
            const t = translations[currentLang];
            const isAd = data.classification === 'advertisement';

            document.getElementById('result-preview-img').src = currentPreviewUrl || document.getElementById('preview-image').src;
            document.getElementById('result-file-name').textContent = currentFile.name;
            document.getElementById('result-file-size').textContent = (currentFile.size / 1024).toFixed(2) + ' KB';

            document.getElementById('result-icon').textContent = '';
            document.getElementById('result-label').textContent = isAd ? t.advertisement : t.scientificArticle;

            const featuresGrid = document.getElementById('features-grid');
            featuresGrid.innerHTML = '';

            // Mostrar explica√ß√£o textual
            if (data.explanation) {
                const explanationDiv = document.createElement('div');
                explanationDiv.className = 'explanation-text';
                let explanation = translateExplanation(data);
                // Colocar todos os n√∫meros em negrito
                explanation = explanation.replace(/(\d+)/g, '<strong>$1</strong>');
                explanationDiv.innerHTML = explanation;
                featuresGrid.appendChild(explanationDiv);
            }

            // Mostrar par√°grafos e palavras lado a lado (apenas para artigos cient√≠ficos)
            if (!isAd && data.num_paragraphs !== undefined) {
                const statsContainer = document.createElement('div');
                statsContainer.className = 'stats-container';
                
                // Par√°grafos
                const paragraphDiv = document.createElement('div');
                paragraphDiv.className = 'stat-item';
                paragraphDiv.innerHTML = `<strong>${t.paragraphs}:</strong> ${data.num_paragraphs}`;
                statsContainer.appendChild(paragraphDiv);
                
                // Palavras
                if (data.word_count !== undefined) {
                    const wordCountDiv = document.createElement('div');
                    wordCountDiv.className = 'stat-item';
                    const wordLabel = currentLang === 'pt' ? 'Palavras' : 'Words';
                    wordCountDiv.innerHTML = `<strong>${wordLabel}:</strong> ${data.word_count}`;
                    statsContainer.appendChild(wordCountDiv);
                }
                
                featuresGrid.appendChild(statsContainer);
            }

            // Mostrar an√°lise de texto (apenas para artigos cient√≠ficos)
            // Mostrar top palavras frequentes (apenas para artigos cient√≠ficos)
            if (!isAd && data.frequent_words && data.frequent_words.length > 0) {
                const wordsContainer = document.createElement('div');
                wordsContainer.className = 'words-container';
                wordsContainer.style.marginTop = '16px';
                
                const wordsTitle = document.createElement('div');
                wordsTitle.className = 'paragraph-count words-title';
                wordsTitle.innerHTML = `<strong>${t.frequentWordsTitle}</strong>`;
                wordsContainer.appendChild(wordsTitle);

                const wordsList = document.createElement('ul');
                wordsList.className = 'word-list';
                if (data.frequent_words.length > 5) {
                    wordsList.classList.add('multi-column');
                }

                data.frequent_words.slice(0, 10).forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `${item.word}: <strong>${item.count}</strong>`;
                    wordsList.appendChild(li);
                });

                wordsContainer.appendChild(wordsList);
                featuresGrid.appendChild(wordsContainer);
            }


            // Reset feedback section
            document.getElementById('feedback-buttons').style.display = 'flex';
            document.getElementById('feedback-success').style.display = 'none';

            
            // Re-enable feedback buttons
            const buttons = document.querySelectorAll('.feedback-btn');
            buttons.forEach(btn => btn.disabled = false);
            document.getElementById('result-section').classList.add('show');
        }

        async function sendFeedback(isCorrect) {
            if (feedbackSent) return;
            
            const t = translations[currentLang];
            const buttons = document.querySelectorAll('.feedback-btn');
            buttons.forEach(btn => btn.disabled = true);

            try {
                const correctClass = isCorrect ? currentClassification.classification : 
                                   (currentClassification.classification === 'advertisement' ? 'scientific_article' : 'advertisement');

                const response = await fetch(`${API_URL}/feedback`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        image_name: currentFile.name,
                        predicted_class: currentClassification.classification,
                        is_correct: isCorrect.toString(),
                        correct_class: correctClass
                    })
                });

                const data = await response.json();

                if (data.success) {
                    feedbackSent = true;
                    document.getElementById('feedback-buttons').style.display = 'none';
                    document.getElementById('feedback-success').textContent = t.feedbackSuccess;
                    document.getElementById('feedback-success').style.display = 'block';
                    console.log(`‚úì Feedback enviado! Total: ${data.total_feedbacks}`);
                }
            } catch (error) {
                console.error('Erro ao enviar feedback:', error);
                buttons.forEach(btn => btn.disabled = false);
            }
        }

        function resetClassifier() {
            currentFile = null;
            currentPreviewUrl = null;
            currentClassification = null;
            feedbackSent = false;
            document.getElementById('file-input').value = '';
            document.getElementById('result-section').classList.remove('show');
            document.getElementById('preview-section').classList.remove('show');
            document.getElementById('upload-section').style.display = 'block';
            hideError();
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            document.getElementById('error').classList.remove('show');
        }
    
        // Fun√ß√µes do Modal de Regras
        function openRuleModal() {
            document.getElementById('rule-modal').classList.add('show');
            document.getElementById('modal-min-words').value = minWords;
            document.getElementById('modal-min-paragraphs').value = minParagraphs;
            updateModalTexts();
        }

        function closeRuleModal() {
            document.getElementById('rule-modal').classList.remove('show');
        }

        function confirmRule() {
            minWords = parseInt(document.getElementById('modal-min-words').value) || 2000;
            minParagraphs = parseInt(document.getElementById('modal-min-paragraphs').value) || 8;
            ruleConfigured = true;
            closeRuleModal();
        }

        function updateModalTexts() {
            const t = translations[currentLang];
            document.getElementById('modal-title').textContent = t.modalTitle;
            document.getElementById('modal-label-words').textContent = t.modalLabelWords;
            document.getElementById('modal-label-paragraphs').textContent = t.modalLabelParagraphs;
            document.getElementById('modal-btn-cancel').textContent = t.modalCancel;
            document.getElementById('modal-btn-confirm').textContent = t.modalConfirm;
        }

        // Fechar modal ao clicar fora
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('rule-modal');
            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeRuleModal();
                    }
                });
            }
        });


        // Inicializar tradu√ß√µes ao carregar
        window.addEventListener('DOMContentLoaded', function() {
            updateTexts();
        });

        function translateExplanation(data) {
            if (!data) return '';
            
            const isAd = data.classification === 'advertisement';
            const isEnglish = currentLang === 'en';
            
            // Extrair informa√ß√µes b√°sicas da explica√ß√£o original
            let explanation = '';
            
            if (isAd) {
                if (isEnglish) {
                    explanation = "Classified as advertisement due to typical characteristics of advertising.";
                } else {
                    explanation = "Classificado como advertisement devido a caracter√≠sticas t√≠picas de an√∫ncios publicit√°rios.";
                }
            } else {
                // Scientific article
                const numParagraphs = data.num_paragraphs || 0;
                const wordCount = data.word_count || 0;
                
                if (isEnglish) {
                    explanation = `Classified as scientific article due to typical characteristics of academic publications.`;
                    
                    if (wordCount > 0) {
                        const isCompliant = data.is_compliant || false;
                        if (isCompliant) {
                            explanation += ` Document COMPLIANT with standards (>${minWords} words and ‚â•${minParagraphs} paragraphs): ${wordCount} words, ${numParagraphs} paragraphs.`;
                        } else {
                            explanation += ` Document NOT COMPLIANT with standards: `;
                            const issues = [];
                            if (wordCount <= minWords) {
                                issues.push(`only ${wordCount} words (minimum: ${minWords})`);
                            }
                            if (numParagraphs < minParagraphs) {
                                issues.push(`only ${numParagraphs} paragraphs (minimum: ${minParagraphs})`);
                            }
                            explanation += issues.join(', ') + '.';
                        }
                    }
                } else {
                    explanation = `Classificado como artigo cient√≠fico devido a caracter√≠sticas t√≠picas de publica√ß√µes acad√™micas.`;
                    
                    if (wordCount > 0) {
                        const isCompliant = data.is_compliant || false;
                        if (isCompliant) {
                            explanation += ` Documento CONFORME √†s normas (>${minWords} palavras e ‚â•${minParagraphs} par√°grafos): ${wordCount} palavras, ${numParagraphs} par√°grafos.`;
                        } else {
                            explanation += ` Documento N√ÉO CONFORME √†s normas: `;
                            const issues = [];
                            if (wordCount <= minWords) {
                                issues.push(`apenas ${wordCount} palavras (m√≠nimo: ${minWords})`);
                            }
                            if (numParagraphs < minParagraphs) {
                                issues.push(`apenas ${numParagraphs} par√°grafos (m√≠nimo: ${minParagraphs})`);
                            }
                            explanation += issues.join(', ') + '.';
                        }
                    }
                }
            }
            
            return explanation;
        }

        function updateExplanationLanguage() {
            if (!currentFullResult) return;
            
            const explanationDiv = document.querySelector('.explanation-text');
            if (explanationDiv) {
                const newExplanation = translateExplanation(currentFullResult);
                explanationDiv.innerHTML = newExplanation.replace(/(\d+)/g, '<strong>$1</strong>');
            }
            
            // Atualizar label de par√°grafos e palavras
            const allStatItems = document.querySelectorAll('.stat-item');
            if (allStatItems.length > 0 && currentFullResult.num_paragraphs) {
                const t = translations[currentLang];
                const wordLabel = currentLang === 'pt' ? 'Palavras' : 'Words';
                
                // Primeiro div √© par√°grafos
                if (allStatItems[0]) {
                    allStatItems[0].innerHTML = `<strong>${t.paragraphs}:</strong> ${currentFullResult.num_paragraphs}`;
                }
                
                // Segundo div √© palavras (se existir)
                if (allStatItems[1] && currentFullResult.word_count) {
                    allStatItems[1].innerHTML = `<strong>${wordLabel}:</strong> ${currentFullResult.word_count}`;
                }
            }
            
            // Atualizar t√≠tulo de palavras frequentes
            const wordsContainer = document.querySelector('.words-container');
            if (wordsContainer && currentFullResult.frequent_words) {
                const t = translations[currentLang];
                const wordsTitle = wordsContainer.querySelector('.words-title');
                if (wordsTitle) {
                    wordsTitle.innerHTML = `<strong>${t.frequentWordsTitle}</strong>`;
                }
            }
        }


        // Atualizar link da API com a URL correta
        document.addEventListener('DOMContentLoaded', function() {
            const apiLink = document.getElementById('api-link');
            if (apiLink) {
                apiLink.href = API_URL + '/api/docs';
            }
        });

</script>

    <!-- Modal de Regras -->
    <div class="modal" id="rule-modal" data-testid="rule-modal">
        <div class="modal-content" data-testid="modal-content">
            <div class="modal-title" id="modal-title" data-testid="modal-title">Configure Compliance Rules</div>
            <div class="modal-field">
                <label for="modal-min-words" id="modal-label-words">Minimum Words</label>
                <input type="number" id="modal-min-words" data-testid="modal-min-words" value="2000" min="100" step="100">
            </div>
            <div class="modal-field">
                <label for="modal-min-paragraphs" id="modal-label-paragraphs">Minimum Paragraphs</label>
                <input type="number" id="modal-min-paragraphs" data-testid="modal-min-paragraphs" value="8" min="1" step="1">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" data-testid="modal-cancel-btn" onclick="closeRuleModal()">
                    <span id="modal-btn-cancel">Cancel</span>
                </button>
                <button class="modal-btn modal-btn-confirm" data-testid="modal-confirm-btn" onclick="confirmRule()">
                    <span id="modal-btn-confirm">Confirm</span>
                </button>
            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-text" id="footer-text" data-testid="footer-text">
                Trabalho do Curso de <strong>Mestrado de Engenharia de Software 2025.1</strong><br>
                C.E.S.A.R - Todos os direitos reservados
            </div>
            <div class="footer-year" id="footer-year" data-testid="footer-year">
                ¬© 2025
            </div>
        </div>
    </footer>

</body>
</html>
